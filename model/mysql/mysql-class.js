var config,connectionthis,copy_table,mysql,sql_count,sql_insert,sql_select,sql_update;mysql=require("mysql"),config=require("../config").config,connectionthis=function(n){return n.call(mysql.createConnection({host:config.mydb,user:config.db_user,password:config.db_passwd,database:config.db_database}))},sql_select=function(n){var t,e,r,o,u,i,s;return i=null!=n.tbname?n.tbname:"test",s=null!=n.where?n.where:!1,e=null!=n.limit?n.limit:!1,t=null!=n.fields?n.fields:"*",r=null!=n.orderby?n.orderby:"id",o=null!=n.sorts?n.sorts:"DESC",u="SELECT "+t+" FROM `"+i+"` "+(s?"WHERE "+s:"")+(" ORDER BY "+r+" "+o+" ")+(e?"limit "+e:"")},sql_insert=function(n){var t;return t="INSERT INTO "+n+" SET ?"},sql_update=function(n,t,e){var r;return r="UPDATE "+n+" SET "+e+" "+(t?"WHERE "+t:"")},sql_count=function(n,t){var e;return e="SELECT count(id) as row_sum FROM `"+n+"` "+(null!=t?" WHERE "+t:"")},copy_table=function(n,t){return"CREATE TABLE "+t+" LIKE "+n},exports.query=function(n,t){return console.log(n),connectionthis(function(){return this.query(n,t)})},exports.row_select=function(n,t){return connectionthis(function(){return this.query(sql_select(n),t)})},exports.row_insert=function(n,t,e){return connectionthis(function(){return console.log("insert: ",t),this.query(sql_insert(n),t,e)})},exports.row_update=function(n,t,e,r){return connectionthis(function(){return this.query(sql_update(n,e,t),r)})},exports.row_count=function(n,t,e){return console.log(sql_count(n,t)),connectionthis(function(){return this.query(sql_count(n,t),function(n,t){return e(n,t[0].row_sum)})})},exports.copy_table=function(n,t,e){return connectionthis(function(){return this.query(copy_table(n,t),e)})},exports.check_table=function(n,t){return connectionthis(function(){return this.query("SHOW TABLES LIKE '"+n+"'",t)})};